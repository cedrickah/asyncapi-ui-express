'use strict';

var express = require('express');
var fs = require('fs');

/**
 * Creates an Express middleware to serve the static files from the given directory.
 * The staic files are the documentation files generated by the AsyncAPI lib.
 *
 * This function validates synchronously that the `outputUrl` exists and is a directory
 * at the time of invocation. If the validation fails, it throws an error immediately.
 *
 * @param {string} outputUrl - The absolute or relative path to the directory
 *                             containing the static files to serve.
 * @returns {RequestHandler} An Express middleware function that serves the static files
 *                           from the specified directory.
 *
 * @throws {Error} Throws if `outputUrl` does not exist or is not a directory.
 *
 * @example
 * ```ts
 * import express from "express";
 * import { serve } from "./serve";
 *
 * const app = express();
 * app.use("/static", serve("./public"));
 *
 * app.listen(3000);
 * ```
 */
function serve(outputUrl) {
    if (!fs.existsSync(outputUrl) || !fs.statSync(outputUrl).isDirectory()) {
        throw new Error(`Provided outputUrl "${outputUrl}" is not a valid directory`);
    }
    return express.static(outputUrl);
}

exports.serve = serve;
